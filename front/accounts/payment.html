<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- 포트원 SDK 라이브러리 추가 -->
    <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      // 객체 초기화
      var IMP = window.IMP;
      IMP.init("imp43760436");

      function requestPay() {
        // 결제창 호출      
        IMP.request_pay(
          {
            pg: "kakaopay.TC0ONETIME",
            pay_method: "card",
            merchant_uid: "57008833-33015", // 상점 고유 주문번호
            name: "포트원 테스트",
            amount: 10,
            buyer_email: "good@portone.io",
            buyer_name: "포트원 기술지원팀",
            buyer_tel: "010-1234-5678",
            buyer_addr: "서울특별시 강남구 삼성동",
            buyer_postcode: "123-456",
          },
          rsp => {
            // 결제 완료 후 서버로 imp_uid와 merchant_uid 전송
            if (rsp.success) {
              axios({
                url: "http://127.0.0.1:8000/api/v1/accounts/payments/", // 서버의 결제 정보를 받는 endpoint
                method: "post",
                headers: { "Content-Type": "application/json" },
                data: {
                  imp_uid: rsp.imp_uid,
                  merchant_uid: rsp.merchant_uid
                }
              })
              .then(function (response) {
                // 서버 결제 API 성공시 로직
                alert("결제가 성공적으로 완료되었습니다!");
              })
              .catch(function (error) {
                // 오류 처리
                alert("서버에서 결제 검증에 실패했습니다.");
              });
            } else {
              // 결제 실패 시 처리
              alert(`결제에 실패하였습니다. 에러 내용: ${rsp.error_msg}`);
            }
          }
        );
      }
    </script>

    <title>결제 테스트</title>
</head>
<body>
    <!-- 결제하기 버튼 생성 -->
    <button onclick="requestPay()">결제하기</button>
</body>
</html>
